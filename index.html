<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ExploRide</title>

  <!-- Pinterest weryfikacja -->
  <meta name="p:domain_verify" content="5e67272b9374687db3751022c1c7559c"/>

  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: #111;
      color: #fff;
      font-family: Arial, Helvetica, sans-serif;
      text-align: center;
    }
    header {
      background: #000;
      color: #fff;
      padding: 20px;
      font-size: 2em;
      font-weight: bold;
      letter-spacing: 2px;
    }
    h2 {
      margin: 28px auto 12px;
      font-size: 1.8em;
      color: #e50914;
      padding: 0 16px;
      max-width: 1200px;
    }
    p.lead {
      margin: 0 auto 8px;
      color: #bbb;
      padding: 0 16px;
      max-width: 900px;
    }

    .player-wrap {
      max-width: 1200px;
      margin: 10px auto 8px;
      padding: 0 16px;
    }
    .ratio {
      position: relative;
      width: 100%;
      max-width: 900px;
      margin: 12px auto 0;
      padding-top: 56.25%; /* 16:9 */
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(255,255,255,0.14);
      background: #000;
    }
    .ratio iframe {
      position: absolute; inset: 0;
      width: 100%; height: 100%;
      border: 0; display: block;
    }

    /* Social */
    .buttons { margin: 18px 0 22px; }
    .buttons a {
      display: inline-block;
      margin: 8px;
      padding: 12px 24px;
      color: #fff;
      text-decoration: none;
      font-size: 1.05em;
      border-radius: 10px;
      transition: background 0.25s, transform 0.2s;
    }
    .buttons a:hover { transform: translateY(-1px); }
    .yt { background: #ff0000; }
    .fb { background: #1877f2; }
    .ig { background: #e1306c; }
    .tt { background: #000000; }

    /* Siatka kafelków */
    #playlist {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 18px;
      max-width: 1200px;
      margin: 18px auto 16px;
      padding: 0 16px;
    }
    .video-tile {
      background: #1e1e1e;
      border-radius: 12px;
      overflow: hidden;
      text-align: left;
      display: flex;
      flex-direction: column;
      transition: transform 0.25s ease;
      border: 1px solid #2a2a2a;
    }
    .video-tile:hover { transform: translateY(-3px); }
    .thumb {
      position: relative;
      width: 100%;
      padding-top: 56.25%; /* 16:9 */
      background: #000;
      overflow: hidden;
    }
    .thumb img {
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      display: block;
    }
    .meta { padding: 10px 12px 12px; }
    .title { font-size: 0.98em; color: #fff; line-height: 1.3; margin: 0 0 4px; }
    .date  { font-size: 0.85em; color: #bbb; }

    .center { max-width: 1200px; margin: 0 auto; padding: 0 16px; }
    .loader { margin: 16px auto 0; color: #bbb; font-size: 0.95em; }
    .fallback {
      background: #1a1a1a; border: 1px solid #2a2a2a;
      border-radius: 12px; padding: 18px; margin: 16px auto 0; max-width: 900px; color: #ddd;
    }

    /* Przycisk "Pokaż kolejne 4" */
    .load-more-wrap {
      margin: 8px 0 36px;
    }
    #loadMore {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 18px;
      border: 0;
      border-radius: 10px;
      background: #e50914;
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
      transition: transform .15s ease, background .2s ease;
    }
    #loadMore:hover { transform: translateY(-1px); background: #b20710; }
    #loadMore[disabled] { opacity: .6; cursor: not-allowed; }
    .arrow { font-size: 1.2em; line-height: 1; }
    footer { color: #bbb; font-size: 0.9em; margin: 24px 0 30px; }
  </style>
</head>
<body>
  <header>ExploRide</header>

  <div class="player-wrap">
    <h2>Zobacz najnowszy film</h2>
    <div class="ratio">
      <iframe
        src="https://www.youtube.com/embed/videoseries?list=PL8VD37UX-sp0Ei-uxx4UEuXtP_5m-5oFn"
        title="YouTube Playlist - ExploRide Opuszczone Miejsca"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowfullscreen
      ></iframe>
    </div>

    <!-- Social -->
    <div class="buttons">
      <a class="yt" href="https://www.youtube.com/@ExploRideURBEX" target="_blank">YouTube</a>
      <a class="fb" href="https://www.facebook.com/ExploRideURBEX" target="_blank">Facebook</a>
      <a class="ig" href="https://www.instagram.com/exploride.urbex" target="_blank">Instagram</a>
      <a class="tt" href="https://www.tiktok.com/@exploride.urbex" target="_blank">TikTok</a>
    </div>
  </div>

  <h2>Wszystkie filmy z playlisty</h2>
  <p class="lead">Wyświetlamy po 4. Kliknij strzałkę, by pokazać kolejne.</p>

  <div class="center">
    <div id="loader" class="loader">Ładowanie listy filmów…</div>
    <div id="fallback" class="fallback" style="display:none;">
      Nie udało się pobrać listy przez API. Działa tryb awaryjny.
    </div>
  </div>

  <div id="playlist"></div>

  <div class="load-more-wrap">
    <button id="loadMore" style="display:none;">
      <span class="arrow">⬇️</span> Pokaż kolejne 4
    </button>
  </div>

  <footer>
    © ExploRide • Urbex, filmy i mapa miejsc, których prawie nie ma
  </footer>

  <script>
    // --- USTAWIENIA ---
    const API_KEY     = "AIzaSyAWgh8sgcGfnEc26JAe5EA-1gNyJw9XZlA";
    const PLAYLIST_ID = "PL8VD37UX-sp0Ei-uxx4UEuXtP_5m-5oFn";

    // Tryb awaryjny: PODMIEŃ TE ID NA SWOJE 8–16 NAJNOWSZYCH WIDEO
    const STATIC_FALLBACK_VIDEO_IDS = [
      "dQw4w9WgXcQ",  // podmień
      "o-YBDTqX_ZU",  // podmień
      "3JZ_D3ELwOQ",  // podmień
      "kxopViU98Xo",  // podmień
      "l482T0yNkeo",  // podmień
      "Zi_XLOBDo_Y",  // podmień
      "2vjPBrBU-TM",  // podmień
      "eVTXPUF4Oz4"   // podmień
    ];

    // Stan paginacji po 4
    const PAGE_SIZE = 4;
    let currentIndex = 0;
    let cachedItems = []; // {id,title,date}

    function fmtDate(isoStr) {
      if (!isoStr) return "";
      const d = new Date(isoStr);
      if (isNaN(d)) return "";
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${day}.${m}.${y}`;
    }

    function makeTiles(items) {
      return items.map(v => {
        const vid   = v.id || v.videoId || "";
        const title = v.title || "Zobacz na YouTube";
        const date  = v.date || "";
        const thumb = `https://i.ytimg.com/vi/${vid}/hqdefault.jpg`;
        return `
          <a class="video-tile" href="https://www.youtube.com/watch?v=${vid}" target="_blank" rel="noopener">
            <div class="thumb">
              <img src="${thumb}" alt="${title}" loading="lazy" />
            </div>
            <div class="meta">
              <div class="title">${title}</div>
              <div class="date">${date}</div>
            </div>
          </a>
        `;
      }).join("");
    }

    function renderNextChunk() {
      const grid = document.getElementById("playlist");
      const next = cachedItems.slice(currentIndex, currentIndex + PAGE_SIZE);
      if (next.length) {
        grid.insertAdjacentHTML("beforeend", makeTiles(next));
        currentIndex += next.length;
      }
      // Pokaż/ukryj przycisk
      const btn = document.getElementById("loadMore");
      if (currentIndex < cachedItems.length) {
        btn.style.display = "inline-flex";
      } else {
        btn.style.display = "none";
      }
    }

    async function fetchAllPlaylistItems(playlistId) {
      const base = "https://www.googleapis.com/youtube/v3/playlistItems";
      let pageToken = "";
      const all = [];
      do {
        const url = new URL(base);
        url.searchParams.set("part", "snippet,contentDetails");
        url.searchParams.set("maxResults", "50");
        url.searchParams.set("playlistId", playlistId);
        url.searchParams.set("key", API_KEY);
        if (pageToken) url.searchParams.set("pageToken", pageToken);

        const res = await fetch(url.toString());
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        if (Array.isArray(data.items)) all.push(...data.items);
        pageToken = data.nextPageToken || "";
      } while (pageToken);

      // Zmapuj i posortuj od najnowszych
      return all.map(item => ({
        id: (item.snippet?.resourceId?.videoId) || (item.contentDetails?.videoId) || "",
        title: item.snippet?.title || "Zobacz na YouTube",
        date: fmtDate(item.contentDetails?.videoPublishedAt || item.snippet?.publishedAt)
      })).sort((a, b) => {
        const da = new Date(a.date.split('.').reverse().join('-')).getTime();
        const db = new Date(b.date.split('.').reverse().join('-')).getTime();
        return db - da; // najnowsze pierwsze
      });
    }

    function buildFallbackList() {
      return STATIC_FALLBACK_VIDEO_IDS.map(id => ({
        id, title: "ExploRide – wideo", date: ""
      }));
    }

    async function init() {
      const loader   = document.getElementById("loader");
      const fallback = document.getElementById("fallback");
      const btn      = document.getElementById("loadMore");

      try {
        cachedItems = await fetchAllPlaylistItems(PLAYLIST_ID);
        loader.style.display = "none";
      } catch (e) {
        console.warn("Playlist API error -> tryb awaryjny", e);
        loader.style.display = "none";
        fallback.style.display = "block";
        cachedItems = buildFallbackList();
      }

      // Start od pierwszych 4
      currentIndex = 0;
      document.getElementById("playlist").innerHTML = "";
      renderNextChunk();

      // Obsługa przycisku
      btn.addEventListener("click", renderNextChunk);
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", init);
    } else {
      init();
    }
  </script>

  <noscript>
    <div style="max-width:900px;margin:20px auto;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:16px;color:#ddd;">
      Ta strona pokazuje kafelki playlisty przez YouTube API. Włącz JavaScript, albo
      <a href="https://www.youtube.com/playlist?list=PL8VD37UX-sp0Ei-uxx4UEuXtP_5m-5oFn" target="_blank" style="color:#fff;text-decoration:underline;">przejdź do playlisty na YouTube</a>.
    </div>
  </noscript>
</body>
</html>
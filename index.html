<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ExploRide</title>

  <!-- Pinterest weryfikacja -->
  <meta name="p:domain_verify" content="5e67272b9374687db3751022c1c7559c"/>

  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: #111;
      color: #fff;
      font-family: Arial, Helvetica, sans-serif;
      text-align: center;
    }
    header {
      background: #000;
      color: #fff;
      padding: 20px;
      font-size: 2em;
      font-weight: bold;
      letter-spacing: 2px;
    }
    h2 {
      margin: 28px auto 12px;
      font-size: 1.8em;
      color: #e50914;
      padding: 0 16px;
      max-width: 1200px;
    }
    p.lead {
      margin: 0 auto 8px;
      color: #bbb;
      padding: 0 16px;
      max-width: 900px;
    }

    .player-wrap {
      max-width: 1200px;
      margin: 10px auto 8px;
      padding: 0 16px;
    }
    .ratio {
      position: relative;
      width: 100%;
      max-width: 900px;
      margin: 12px auto 0;
      padding-top: 56.25%; /* 16:9 */
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(255,255,255,0.14);
      background: #000;
    }
    .ratio iframe {
      position: absolute; inset: 0;
      width: 100%; height: 100%;
      border: 0; display: block;
    }

    /* Social */
    .buttons { margin: 18px 0 22px; }
    .buttons a {
      display: inline-block;
      margin: 8px;
      padding: 12px 24px;
      color: #fff;
      text-decoration: none;
      font-size: 1.05em;
      border-radius: 10px;
      transition: background 0.25s, transform 0.2s;
    }
    .buttons a:hover { transform: translateY(-1px); }
    .yt { background: #ff0000; }
    .fb { background: #1877f2; }
    .ig { background: #e1306c; }
    .tt { background: #000000; }

    /* Siatka kafelków */
    .playlist-window {
      max-width: 1200px;
      margin: 18px auto 40px;
      padding: 0 16px;
      position: relative;
      overflow: hidden;
    }
    #playlist {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 18px;
    }
    .nav-btn {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.6);
      border: none;
      color: #fff;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 1.2em;
    }
    .nav-btn.up { top: 0; }
    .nav-btn.down { bottom: 0; }
    .video-tile {
      background: #1e1e1e;
      border-radius: 12px;
      overflow: hidden;
      text-align: left;
      display: flex;
      flex-direction: column;
      transition: transform 0.25s ease;
      border: 1px solid #2a2a2a;
    }
    .video-tile:hover { transform: translateY(-3px); }
    .thumb {
      position: relative;
      width: 100%;
      padding-top: 56.25%; /* 16:9 */
      background: #000;
      overflow: hidden;
    }
    .thumb img {
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      display: block;
    }
    .meta { padding: 10px 12px 12px; }
    .title { font-size: 0.98em; color: #fff; line-height: 1.3; margin: 0 0 4px; }
    .date  { font-size: 0.85em; color: #bbb; }

    .center { max-width: 1200px; margin: 0 auto; padding: 0 16px; }
    .loader { margin: 16px auto 0; color: #bbb; font-size: 0.95em; }
    .fallback {
      background: #1a1a1a; border: 1px solid #2a2a2a;
      border-radius: 12px; padding: 18px; margin: 16px auto 0; max-width: 900px; color: #ddd;
    }
    .fallback a.btn {
      display: inline-block; margin-top: 10px; padding: 10px 16px;
      border-radius: 10px; background: #e50914; color: #fff; text-decoration: none;
    }

    footer { color: #bbb; font-size: 0.9em; margin: 24px 0 30px; }
  </style>
</head>
<body>
  <header>ExploRide</header>

  <div class="player-wrap">
    <h2>Zobacz najnowszy film</h2>
    <div class="ratio">
      <!-- Player playlisty (YouTube sam odtworzy najnowszy jako pierwszy) -->
      <iframe
        src="https://www.youtube.com/embed/videoseries?list=PL8VD37UX-sp0Ei-uxx4UEuXtP_5m-5oFn"
        title="YouTube Playlist - ExploRide Opuszczone Miejsca"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowfullscreen
      ></iframe>
    </div>

    <!-- SOCIAL -->
    <div class="buttons">
      <a class="yt" href="https://www.youtube.com/@ExploRideURBEX" target="_blank">YouTube</a>
      <a class="fb" href="https://www.facebook.com/ExploRideURBEX" target="_blank">Facebook</a>
      <a class="ig" href="https://www.instagram.com/exploride.urbex" target="_blank">Instagram</a>
      <a class="tt" href="https://www.tiktok.com/@exploride.urbex" target="_blank">TikTok</a>
    </div>
  </div>

  <h2>Wszystkie filmy z playlisty</h2>
  <p class="lead">Kafelki poniżej automatycznie pomijają najnowszy film (jest wyżej w playerze).</p>

  <div class="center">
    <div id="loader" class="loader">Ładowanie listy filmów…</div>
    <div id="fallback" class="fallback" style="display:none;">
      Nie udało się pobrać listy przez API. Pokazuję kafelki w trybie awaryjnym.
      <br />
      <a class="btn" target="_blank" href="https://www.youtube.com/playlist?list=PL8VD37UX-sp0Ei-uxx4UEuXtP_5m-5oFn">Otwórz playlistę na YouTube</a>
    </div>
  </div>

  <div id="playlist-window" class="playlist-window" tabindex="0">
    <button id="btnPrev" class="nav-btn up" aria-label="Pokaż wcześniejsze filmy">&#9650;</button>
    <div id="playlist"></div>
    <button id="btnNext" class="nav-btn down" aria-label="Pokaż kolejne filmy">&#9660;</button>
  </div>

  <footer>
    © ExploRide • Urbex, filmy i mapa miejsc, których prawie nie ma
  </footer>

  <!-- Skrypt na końcu, by statyczna treść zawsze się wyświetliła -->
  <script>
    // --- USTAWIENIA ---
    const API_KEY     = "AIzaSyAWgh8sgcGfnEc26JAe5EA-1gNyJw9XZlA";
    const PLAYLIST_ID = "PL8VD37UX-sp0Ei-uxx4UEuXtP_5m-5oFn";
    const PAGE_SIZE   = 4;
    let allVideos = [];
    let currentIndex = 0;
    let btnPrev, btnNext;

    // Tryb awaryjny: PODMIEŃ TE ID NA SWOJE STARSZE FILMY (nie najnowszy)
    const STATIC_FALLBACK_VIDEO_IDS = [
      "dQw4w9WgXcQ",  // <- podmień (starszy film)
      "o-YBDTqX_ZU",  // <- podmień
      "3JZ_D3ELwOQ"   // <- podmień
    ];

    // ---- Pomocnicze ----
    function toISOorNull(x) {
      // YouTube zwraca datę w ISO. Zwróć null jeśli pusta.
      if (!x) return null;
      const t = Date.parse(x);
      return isNaN(t) ? null : new Date(t).toISOString();
    }
    function fmtDate(isoStr) {
      if (!isoStr) return "";
      const d = new Date(isoStr);
      if (isNaN(d)) return "";
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${day}.${m}.${y}`;
    }

    function renderTiles(items) {
      const grid = document.getElementById("playlist");
      grid.innerHTML = items.map(v => {
        const vid   = v.id;
        const title = v.title || "Zobacz na YouTube";
        const date  = v.publishedAtISO ? fmtDate(v.publishedAtISO) : (v.date || "");
        const thumb = v.thumb || `https://i.ytimg.com/vi/${vid}/hqdefault.jpg`;
        return `
          <a class="video-tile" href="https://www.youtube.com/watch?v=${vid}" target="_blank" rel="noopener">
            <div class="thumb">
              <img src="${thumb}" alt="${title}" loading="lazy" />
            </div>
            <div class="meta">
              <div class="title">${title}</div>
              <div class="date">${date}</div>
            </div>
          </a>
        `;
      }).join("");
    }

    function updateNav() {
      if (!btnPrev || !btnNext) return;
      btnPrev.style.display = currentIndex > 0 ? "block" : "none";
      btnNext.style.display = currentIndex + PAGE_SIZE < allVideos.length ? "block" : "none";
    }

    function renderPage() {
      const slice = allVideos.slice(currentIndex, currentIndex + PAGE_SIZE);
      renderTiles(slice);
      updateNav();
    }

    async function fetchAllPlaylistItems(playlistId) {
      const base = "https://www.googleapis.com/youtube/v3/playlistItems";
      let pageToken = "";
      const all = [];
      do {
        const url = new URL(base);
        url.searchParams.set("part", "snippet,contentDetails");
        url.searchParams.set("maxResults", "50");
        url.searchParams.set("playlistId", playlistId);
        url.searchParams.set("key", API_KEY);
        if (pageToken) url.searchParams.set("pageToken", pageToken);

        const res = await fetch(url.toString());
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        if (Array.isArray(data.items)) all.push(...data.items);
        pageToken = data.nextPageToken || "";
      } while (pageToken);

      // Zmapuj do uproszczonego formatu
      return all.map(item => {
        const vid = item.snippet?.resourceId?.videoId || item.contentDetails?.videoId || "";
        const iso = toISOorNull(item.contentDetails?.videoPublishedAt || item.snippet?.publishedAt);
        return {
          id: vid,
          title: item.snippet?.title || "Bez tytułu",
          publishedAtISO: iso,
          thumb: item.snippet?.thumbnails?.medium?.url || item.snippet?.thumbnails?.high?.url || ""
        };
      });
    }

    function renderStaticFallback() {
      allVideos = STATIC_FALLBACK_VIDEO_IDS.map(id => ({
        id,
        title: "ExploRide – wideo",
        date: "", // można wpisać ręcznie daty, jeśli chcesz
        thumb: `https://i.ytimg.com/vi/${id}/hqdefault.jpg`
      }));
      currentIndex = 0;
      renderPage();
    }

    async function init() {
      const loader   = document.getElementById("loader");
      const fallback = document.getElementById("fallback");
      btnPrev = document.getElementById("btnPrev");
      btnNext = document.getElementById("btnNext");
      const win = document.getElementById("playlist-window");

      btnPrev.addEventListener("click", () => {
        currentIndex = Math.max(0, currentIndex - PAGE_SIZE);
        renderPage();
      });
      btnNext.addEventListener("click", () => {
        if (currentIndex + PAGE_SIZE < allVideos.length) {
          currentIndex += PAGE_SIZE;
          renderPage();
        }
      });
      win.addEventListener("keydown", e => {
        if (e.key === "ArrowDown") { e.preventDefault(); btnNext.click(); }
        if (e.key === "ArrowUp")   { e.preventDefault(); btnPrev.click(); }
      });
      win.focus();

      try {
        let list = await fetchAllPlaylistItems(PLAYLIST_ID);

        // Posortuj od najnowszych (po ISO)
        list.sort((a, b) => {
          const ta = a.publishedAtISO ? Date.parse(a.publishedAtISO) : 0;
          const tb = b.publishedAtISO ? Date.parse(b.publishedAtISO) : 0;
          return tb - ta;
        });

        // Usuń najnowszy (pierwszy po sortowaniu)
        if (list.length > 0) list = list.slice(1);

        allVideos = list;
        currentIndex = 0;
        renderPage();
        loader.style.display = "none";
      } catch (e) {
        console.warn("Playlist API error -> tryb awaryjny", e);
        loader.style.display = "none";
        fallback.style.display = "block";
        renderStaticFallback();
      }
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", init);
    } else {
      init();
    }
  </script>

  <noscript>
    <div style="max-width:900px;margin:20px auto;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:16px;color:#ddd;">
      Ta strona pokazuje kafelki playlisty przez YouTube API. Włącz JavaScript, albo
      <a href="https://www.youtube.com/playlist?list=PL8VD37UX-sp0Ei-uxx4UEuXtP_5m-5oFn" target="_blank" style="color:#fff;text-decoration:underline;">przejdź do playlisty na YouTube</a>.
    </div>
  </noscript>
</body>
</html>
